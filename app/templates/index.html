{% extends 'base.html' %}

{% block title %}Sensotura{% endblock %}

{% block main %}


<div class="generalIndicators">

    <h2>Текущая температура устройств</h2>
    <div class="fridges">
        {% for fridge in fridges %}
        <div class="fridge">
           <div class="fridge_pic">
                {% if fridge.last_temp <= -35 %}
                <img src="{{ url_for('static', filename='img/greenTemp.png') }}">
                {% elif -35 < fridge.last_temp <= -30 %}
                <img src="{{ url_for('static', filename='img/orangeTemp.png') }}">
                {% elif fridge.last_temp > -30 %}
                <img src="{{ url_for('static', filename='img/redTemp.png') }}">
                {% endif %}
           </div>
           <div class="fridge_info">
                <h3>{{ fridge.name }}</h3>
                {% if fridge.last_temp <= -35 %} 
                <p class="fridge_temp" style="color: #1b922f">{{ fridge.last_temp }} °C</p>
                {% elif -35 < fridge.last_temp <= -30  %}
                <p class="fridge_temp" style="color: #f59e0b">{{ fridge.last_temp }} °C</p>
                {% elif fridge.last_temp > -30 %}
                <p class="fridge_temp" style="color: #ef4444">{{ fridge.last_temp }} °C</p>
                {% endif %}
                <p class="fridge_temp_lst_updt">Обновлено: {{ fridge.last_time }}</p>
           </div>
        </div>
        {% endfor %}
    </div>
    <h2>График температуры устройств за последние 12 часов</h2>
    <div class="chartContainer">
        <canvas class="tempChart" id="tempChart"></canvas>
    </div>
</div>

<script>
    const labels = {{ labels | tojson }};
    const datasets = {{ datasets | tojson }};

    console.log('Chart labels:', labels);
    console.log('Chart datasets:', datasets);

    const ctx = document.getElementById('tempChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: datasets
        },
        options: {
            responsive: true,
            spanGaps: false,
            maintainAspectRatio: false,
            scales: {
                x: {
                    border: { display: false },
                    grid: { display: false, drawBorder: false }
                },
                y: {
                    border: { display: false },
                    grid: {
                        display: true,
                        drawBorder: false,
                        color: '#e5e7eb'
                    }
                }
            },
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        usePointStyle: true,
                        pointStyle: 'line',
                        font: {
                            family: 'Inter'
                        }
                    }
                }
            }
        }
    });
</script>

{% endblock %}